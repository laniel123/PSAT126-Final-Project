---
title: "PSTAT 126 Final Project"
author: "Daniel Larson, Emanuel Rodriguez"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    theme: flatly
    highlight: tango
    code_folding: hide
    fig_caption: true
    df_print: paged
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  out.width = "80%"
)
```

# Introduction

This project analyzes a sample of 500 diamonds from the full dataset to explore how various diamond attributes — carat, cut, color, depth, table, and clarity — relate to price. We compute descriptive statistics, generate visualizations, and fit regression models (both simple and multiple, with and without log‑transformation of price). Finally, we examine model diagnostics and provide confidence/prediction intervals for meaningful predictions.

# Part 1: Data Description and Descriptive Statistics

## 1. Data Loading & Sampling

```{r}
filepath <- "/Users/daniellarson/Downloads/Diamonds Prices2022.csv"
df <- read.csv(filepath)

set.seed(777)
sample_df <- df[sample(nrow(df), 500), ]
```

## 2. Summary Statistics & Distributions

```{r}
summary(sample_df)
```

### 2.1 Histograms of Continuous Variables

```{r}

hist(sample_df$carat,
     main = "Histogram of Diamond Carats",
     xlab = "Carat",
     ylab = "Frequency",
     col = "purple", border = "black")

hist(sample_df$depth,
     main = "Histogram of Diamond Depths",
     xlab = "Depth",
     ylab = "Frequency",
     col = "red", border = "black")

hist(sample_df$table,
     main = "Histogram of Diamond Tables",
     xlab = "Table",
     ylab = "Frequency",
     col = "blue", border = "black")

hist(sample_df$price,
     main = "Histogram of Diamond Prices",
     xlab = "Price ($)",
     ylab = "Frequency",
     col = "green", border = "black")
```

### 2.2 Barplots: Categorical Variables

```{r}
barplot(table(sample_df$cut),
        main = "Cut Quality (Count)",
        xlab = "Cut")

barplot(table(sample_df$color),
        main = "Color Grade (Count)",
        xlab = "Color")
```

# Part 2: Relationships and Regression Analysis

## 3. Correlation & Scatter/Box Plots

```{r}
quant_vars <- sample_df[, c("table", "carat", "depth")]

cor(quant_vars)
pairs(quant_vars)

boxplot(price ~ color, data = sample_df, main = "Price by Color")
boxplot(price ~ cut, data = sample_df, main = "Price by Cut")
```

## 4. Multiple Linear Regression

```{r}
diamondmodel <- lm(price ~ color + cut + carat + depth + table,
                   data = sample_df)
summary(diamondmodel)
```

# Part 3: Simple vs. Log‑Transformed Regression Models

## 5. Simple Linear Regression

```{r}
model_simple <- lm(price ~ carat, data = sample_df)
summary(model_simple)
```

### 5.1 Prediction Intervals

```{r}
new_carat <- data.frame(carat = 1)
predict(model_simple, new_carat, interval = "confidence")
predict(model_simple, new_carat, interval = "prediction")
```

### 5.2 Regression Plot

```{r}
plot(sample_df$carat, sample_df$price,
     xlab = "Carat", ylab = "Price",
     main = "Price vs Carat with Regression Line")
abline(model_simple, lwd = 2)
```

### 5.3 Diagnostics

```{r}
par(mfrow = c(2,2))
plot(model_simple)
```

## 6. Log‑Transformed Model

```{r}
log_model <- lm(log(price) ~ carat, data = sample_df)
summary(log_model)
```

## 7. Model Comparison (Hidden Code)

```{r, echo = FALSE}
model_log <- lm(log(price) ~ carat, data = sample_df)

test_1 <- model_log
test_2 <- lm(log(price) ~ depth + carat, data = sample_df)
test_3 <- lm(log(price) ~ color + carat + depth, data = sample_df)
test_4 <- lm(log(price) ~ cut + color + carat + depth, data = sample_df)
test_5 <- lm(log(price) ~ carat + depth + table + color + cut,
             data = sample_df)

c(
  base = summary(test_1)$adj.r.squared,
  m2   = summary(test_2)$adj.r.squared,
  m3   = summary(test_3)$adj.r.squared,
  m4   = summary(test_4)$adj.r.squared,
  m5   = summary(test_5)$adj.r.squared
)
```

# Part 4: Final Model & Diagnostics

```{r}
bestmodel <- lm(log(price) ~ carat + depth + table + color + cut + clarity,
                data = sample_df)
summary(bestmodel)

AIC(bestmodel)
BIC(bestmodel)

library(car)
vif(bestmodel)

confint(bestmodel)

new_obs <- data.frame(
  carat = 1,
  depth = 61,
  table = 57,
  color = "G",
  cut = "Ideal",
  clarity = "VS2"
)

predict(bestmodel, newdata = new_obs, interval = "confidence")
predict(bestmodel, newdata = new_obs, interval = "prediction")

par(mfrow = c(2,2))
plot(bestmodel)
```

# Conclusion

This analysis shows how diamond characteristics influence pricing, highlights the usefulness of log‑transformations, and demonstrates the importance of diagnostics and variable selection in regression modeling.
